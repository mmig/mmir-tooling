!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.scionCoreLib=e():t.scionCoreLib=e()}(window,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=4)}([function(t,e){var n,r,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(t){r=a}}();var u,c=[],l=!1,f=-1;function p(){l&&u&&(l=!1,u.length?c=u.concat(c):f=-1,c.length&&h())}function h(){if(!l){var t=s(p);l=!0;for(var e=c.length;e;){for(u=c,c=[];++f<e;)u&&u[f].run();f=-1,e=c.length}u=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function y(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new d(t,e)),1!==c.length||l||s(h)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=y,i.addListener=y,i.once=y,i.off=y,i.removeListener=y,i.removeAllListeners=y,i.emit=y,i.prependListener=y,i.prependOnceListener=y,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e){t.exports={STATE_TYPES:{BASIC:0,COMPOSITE:1,PARALLEL:2,HISTORY:3,INITIAL:4,FINAL:5},SCXML_IOPROCESSOR_TYPE:"http://www.w3.org/TR/scxml/#SCXMLEventProcessor",HTTP_IOPROCESSOR_TYPE:"http://www.w3.org/TR/scxml/#BasicHTTPEventProcessor",RX_TRAILING_WILDCARD:/\.\*$/}},function(t,e,n){(function(t){var r=void 0!==t&&t||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new o(i.call(setTimeout,r,arguments),clearTimeout)},e.setInterval=function(){return new o(i.call(setInterval,r,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(r,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},n(6),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,n(3))},function(t,e){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"===("undefined"==typeof window?"undefined":n(window))&&(r=window)}t.exports=r},function(t,e,n){t.exports=n(5)},function(t,e,n){(function(e){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function a(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var c=n(7),l=(c.helpers,c.query),f=c.helpers.transitionComparator,p=function(t){function e(t,n){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=n||{}).legacySemantics=!1,a(this,s(e).call(this,t,n))}var n,r,p;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(e,c.BaseInterpreter),n=e,(r=[{key:"_selectTransitions",value:function(t,e){var n=this.opts.transitionSelector,r=new this.opts.Set,i=this._evaluateAction.bind(this,t),o=this._configuration.iter().sort(f),a=!0,s=!1,u=void 0;try{for(var c,p=o[Symbol.iterator]();!(a=(c=p.next()).done);a=!0){var h=c.value,d=!0,y=!1,v=void 0;try{t:for(var g,m=[h].concat(l.getAncestors(h))[Symbol.iterator]();!(d=(g=m.next()).done);d=!0){var _=g.value,S=!0,b=!1,E=void 0;try{for(var w,x=_.transitions[Symbol.iterator]();!(S=(w=x.next()).done);S=!0){var T=w.value;if(n(T,t,i,e)){r.add(T);break t}}}catch(t){b=!0,E=t}finally{try{S||null==x.return||x.return()}finally{if(b)throw E}}}}catch(t){y=!0,v=t}finally{try{d||null==m.return||m.return()}finally{if(y)throw v}}}}catch(t){s=!0,u=t}finally{try{a||null==p.return||p.return()}finally{if(s)throw u}}var O=this._removeConflictingTransition(r);return this._log("priorityEnabledTransitions",O),O}},{key:"_removeConflictingTransition",value:function(t){var e=this,n=new this.opts.Set,r=!0,o=!1,a=void 0;try{for(var s,u=t.iter()[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var c=s.value,l=!1,f=new Set,p=!0,h=!1,d=void 0;try{for(var y,v=function(){var t=y.value,n=e._computeExitSet([c]),r=e._computeExitSet([t]),o=i(n).some(function(t){return r.has(t)})||i(r).some(function(t){return n.has(t)});if(e._log("t1ExitSet",c.source.id,i(n).map(function(t){return t.id})),e._log("t2ExitSet",t.source.id,i(r).map(function(t){return t.id})),e._log("hasIntersection",o),o){if(!(t.source.descendants.indexOf(c.source)>-1))return l=!0,"break";f.add(t)}},g=n.iter()[Symbol.iterator]();!(p=(y=g.next()).done);p=!0){if("break"===v())break}}catch(t){h=!0,d=t}finally{try{p||null==g.return||g.return()}finally{if(h)throw d}}if(!l){var m=!0,_=!1,S=void 0;try{for(var b,E=f[Symbol.iterator]();!(m=(b=E.next()).done);m=!0){var w=b.value;n.remove(w)}}catch(t){_=!0,S=t}finally{try{m||null==E.return||E.return()}finally{if(_)throw S}}n.add(c)}}}catch(t){o=!0,a=t}finally{try{r||null==u.return||u.return()}finally{if(o)throw a}}return n}}])&&o(n.prototype,r),p&&o(n,p),e}();c.Statechart=p,c.InterpreterScriptingContext.invokers={"http://www.w3.org/TR/scxml/":function(t,n,r,i){if(!n.constructorFunction)throw new Error("Invoke object needs a constructorFunction property");var o,a=n.constructorFunction,s={invokeid:n.id,params:n.params,parentSession:t,docUrl:n.docUrl},u=r;s.parentSession instanceof p&&(o=new p(a,s)),i(null,o,a,u),e(function(){return o.start()})}},c.InterpreterScriptingContext.invokers[void 0]=c.InterpreterScriptingContext.invokers.null=c.InterpreterScriptingContext.invokers.scxml=c.InterpreterScriptingContext.invokers["http://www.w3.org/TR/scxml/"],t.exports=c}).call(this,n(2).setImmediate)},function(t,e,n){(function(t,e){!function(t,n){"use strict";if(!t.setImmediate){var r,i,o,a,s,u=1,c={},l=!1,f=t.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(t);p=p&&p.setTimeout?p:t,"[object process]"==={}.toString.call(t.process)?r=function(t){e.nextTick(function(){d(t)})}:!function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?t.MessageChannel?((o=new MessageChannel).port1.onmessage=function(t){d(t.data)},r=function(t){o.port2.postMessage(t)}):f&&"onreadystatechange"in f.createElement("script")?(i=f.documentElement,r=function(t){var e=f.createElement("script");e.onreadystatechange=function(){d(t),e.onreadystatechange=null,i.removeChild(e),e=null},i.appendChild(e)}):r=function(t){setTimeout(d,0,t)}:(a="setImmediate$"+Math.random()+"$",s=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(a)&&d(+e.data.slice(a.length))},t.addEventListener?t.addEventListener("message",s,!1):t.attachEvent("onmessage",s),r=function(e){t.postMessage(a+e,"*")}),p.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var i={callback:t,args:e};return c[u]=i,r(u),u++},p.clearImmediate=h}function h(t){delete c[t]}function d(t){if(l)setTimeout(d,0,t);else{var e=c[t];if(e){l=!0;try{!function(t){var e=t.callback,r=t.args;switch(r.length){case 0:e();break;case 1:e(r[0]);break;case 2:e(r[0],r[1]);break;case 3:e(r[0],r[1],r[2]);break;default:e.apply(n,r)}}(e)}finally{h(t),l=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,n(3),n(0))},function(t,e,n){"use strict";(function(e,r){function i(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function o(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e,n){return e&&u(t.prototype,e),n&&u(t,n),t}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t,e){return(p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var h=n(8).EventEmitter,d=n(9),y=n(12),v=n(1),g=n(13),m=n(14),_=g.extend,S=g.transitionWithTargets,b=g.transitionComparator,E=g.initializeModel,w=(g.isEventPrefixMatch,g.isTransitionMatch,g.scxmlPrefixTransitionSelector),x=(g.eventlessTransitionSelector,g.getTransitionWithHigherSourceChildPriority),T=g.sortInEntryOrder,O=g.getStateWithHigherSourceChildPriority,k=g.initializeModelGeneratorFn,A=g.deserializeSerializedConfiguration,I=g.deserializeHistory,C=v.STATE_TYPES.BASIC,j=v.STATE_TYPES.COMPOSITE,P=v.STATE_TYPES.PARALLEL,R=v.STATE_TYPES.HISTORY,z=v.STATE_TYPES.INITIAL,M=v.STATE_TYPES.FINAL,D=v.SCXML_IOPROCESSOR_TYPE,L=void 0!==e&&!!e.env.DEBUG,F=function(e){function n(e,r){var i,o,u;s(this,n),o=this,(i=!(u=l(n).call(this))||"object"!==a(u)&&"function"!=typeof u?f(o):u).opts=r,i.opts.InterpreterScriptingContext=i.opts.InterpreterScriptingContext||$,i._isStepping=!1,i._scriptingContext=i.opts.interpreterScriptingContext||(i.opts.InterpreterScriptingContext?new i.opts.InterpreterScriptingContext(f(i)):{}),i.opts.generateSessionid=i.opts.generateSessionid||n.generateSessionid,i.opts.sessionid=i.opts.sessionid||i.opts.generateSessionid(),i.opts.sessionRegistry=i.opts.sessionRegistry||n.sessionRegistry,i.opts.invokerExecutionContext=r.invokerExecutionContext||e._executionContext;var c,p={};if(p[D]={location:"#_scxml_".concat(i.opts.sessionid)},p.scxml=p[D],i.opts._x={_sessionid:i.opts.sessionid,_ioprocessors:p},"function"==typeof e)c=k(e,i.opts,f(i));else{if("object"!==a(e))throw new Error("Unexpected model type. Expected model factory function, or scjson object.");c=JSON.parse(JSON.stringify(e))}return i._model=E(c,i.opts),i.opts.console=i.opts.console||("undefined"==typeof console?{log:function(){}}:console),i.opts.Set=i.opts.Set||y,i.opts.priorityComparisonFn=i.opts.priorityComparisonFn||x,i.opts.transitionSelector=i.opts.transitionSelector||w,i.opts.sessionRegistry.set(String(i.opts.sessionid),f(i)),i._scriptingContext.log=i._scriptingContext.log||function(){this.opts.console.log.apply?this.opts.console.log.apply(this.opts.console,arguments):this.opts.console.log(Array.prototype.slice.apply(arguments).join(","))}.bind(f(i)),i._externalEventQueue=[],i._internalEventQueue=[],i.opts.params&&i._model.$deserializeDatamodel(i.opts.params),i.opts.snapshot?(i._configuration=new i.opts.Set(A(i.opts.snapshot[0],i._model.$idToStateMap)),i._historyValue=I(i.opts.snapshot[1],i._model.$idToStateMap),i._isInFinalState=i.opts.snapshot[2],i._model.$deserializeDatamodel(i.opts.snapshot[3]),i._internalEventQueue=i.opts.snapshot[4]):(i._configuration=new i.opts.Set,i._historyValue={},i._isInFinalState=!1),n.EVENTS.forEach(function(t){this.on(t,this._log.bind(this,t))},f(i)),t.exports.emit("new",f(i)),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&p(t,e)}(n,h),c(n,[{key:"cancel",value:function(){delete this.opts.parentSession,this._isInFinalState||(this._isInFinalState=!0,this._log("session cancelled ".concat(this.opts.invokeid)),this._exitInterpreter(null))}},{key:"_exitInterpreter",value:function(t){var e=this;this._cancelAllDelayedSends();for(var n=this._getFullConfiguration().sort(O),r=0,i=n.length;r<i;r++){var o=n[r];if(void 0!==o.onExit)for(var a=0,s=o.onExit.length;a<s;a++)for(var u=o.onExit[a],c=0,l=u.length;c<l;c++){var f=u[c];try{f.call(this._scriptingContext,null)}catch(t){this._handleError(t,f);break}}o.invokes&&o.invokes.forEach(function(t){e._scriptingContext.cancelInvoke(t.id)}),"final"===o.$type&&"scxml"===o.parent.$type&&(this.opts.parentSession&&this._scriptingContext.send({target:"#_parent",name:"done.invoke."+this.opts.invokeid,data:o.donedata&&o.donedata.call(this._scriptingContext,t)}),this.opts.sessionRegistry.delete(this.opts.sessionid),this.emit("onExitInterpreter",t))}}},{key:"start",value:function(){return this._initStart(),this._performBigStep(),this.getConfiguration()}},{key:"startAsync",value:function(t){t=this._initStart(t),this.genAsync(null,t)}},{key:"_initStart",value:function(t){var e=this;return"function"!=typeof t&&(t=B),this._log("performing initial big step"),this._model.initialRef.forEach(function(t){return e._configuration.add(t)}),t}},{key:"getConfiguration",value:function(){return this._configuration.iter().map(function(t){return t.id})}},{key:"_getFullConfiguration",value:function(){return this._configuration.iter().map(function(t){return[t].concat(m.getAncestors(t))},this).reduce(function(t,e){return t.concat(e)},[]).reduce(function(t,e){return t.indexOf(e)>-1?t:t.concat(e)},[])}},{key:"getFullConfiguration",value:function(){return this._getFullConfiguration().map(function(t){return t.id})}},{key:"isIn",value:function(t){return this.getFullConfiguration().indexOf(t)>-1}},{key:"isFinal",value:function(){return this._isInFinalState}},{key:"_performBigStep",value:function(t){var e,n,r,i,a=o(this._startBigStep(t),4);for(r=a[0],i=a[1],n=a[2],e=a[3];n;){var s=o(this._selectTransitionsAndPerformSmallStep(e,i,r),2);e=s[0],n=s[1]}this._finishBigStep(e,i,r)}},{key:"_selectTransitionsAndPerformSmallStep",value:function(t,e,n){var r=this._selectTransitions(t,!0);if(r.isEmpty()){var i=this._internalEventQueue.shift();i&&(t=i,r=this._selectTransitions(t,!1))}if(!r.isEmpty()){var a,s;this.emit("onSmallStepBegin",t);var u=o(this._performSmallStep(t,r),2);a=u[0],s=u[1],a&&a.forEach(function(t){return n.add(t)}),s&&s.forEach(function(t){return e.add(t)}),this.emit("onSmallStepEnd",t)}return[t,!r.isEmpty()||this._internalEventQueue.length]}},{key:"_startBigStep",value:function(t){var e=this;this.emit("onBigStepBegin",t),this._configuration.iter().forEach(function(n){n.invokes&&n.invokes.forEach(function(n){n.autoforward&&e._scriptingContext.send({target:"#_".concat(n.id),name:t.name,data:t.data}),n.id===t.invokeid&&n.finalize&&n.finalize.forEach(function(n){return e._evaluateAction(t,n)})})}),t&&this._internalEventQueue.push(t);var n=new Set;return[new Set,n,!0,t]}},{key:"_finishBigStep",value:function(t,e,n,r){var o=this;Array.from(new Set(i(e).filter(function(t){return t.invokes&&!n.has(t)}))).sort(T).forEach(function(e){e.invokes.forEach(function(e){return o._evaluateAction(t,e)})}),n.forEach(function(t){t.invokes&&t.invokes.forEach(function(t){o._scriptingContext.cancelInvoke(t.id)})}),this._isInFinalState=this._configuration.iter().every(function(t){return t.typeEnum===M}),this._isInFinalState&&this._exitInterpreter(t),this.emit("onBigStepEnd",t),r&&r(void 0,this.getConfiguration())}},{key:"_cancelAllDelayedSends",value:function(){var t=!0,e=!1,n=void 0;try{for(var r,i=this._scriptingContext._timeouts[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var o=r.value;o.sendOptions.delay&&(this._log("cancelling delayed send",o),clearTimeout(o.timeoutHandle),this._scriptingContext._timeouts.delete(o))}}catch(t){e=!0,n=t}finally{try{t||null==i.return||i.return()}finally{if(e)throw n}}Object.keys(this._scriptingContext._timeoutMap).forEach(function(t){delete this._scriptingContext._timeoutMap[t]},this)}},{key:"_performBigStepAsync",value:function(t,e){var n,i,a,s=o(this._startBigStep(t),4);i=s[0],a=s[1],s[2],n=s[3],function t(s){this.emit(s);var u=o(this._selectTransitionsAndPerformSmallStep(n,a,i),2);n=u[0],u[1]?(this.emit("onBigStepSuspend"),r(t.bind(this,"onBigStepResume"))):this._finishBigStep(n,a,i,e)}.call(this,"onBigStepBegin")}},{key:"_performSmallStep",value:function(t,e){var n,r;if(this._log("selecting transitions with currentEvent",t),this._log("selected transitions",e),!e.isEmpty()){var i=new this.opts.Set(e.iter().filter(S));n=this._exitStates(t,i),this._executeTransitions(t,e),r=this._enterStates(t,i),this._log("new configuration ",this._configuration)}return[n,r]}},{key:"_exitStates",value:function(t,e){var n,r=o(this._getStatesExited(e),2);r[0],n=r[1],this._log("exiting states");for(var i=0,a=n.length;i<a;i++){var s,u=n[i];if(u.isAtomic&&this._configuration.remove(u),this._log("exiting ",u.id),this.emit("onExit",u.id),void 0!==u.onExit)for(var c=0,l=u.onExit.length;c<l;c++)for(var f=u.onExit[c],p=0,h=f.length;p<h;p++){var d=f[p];try{d.call(this._scriptingContext,t)}catch(t){this._handleError(t,d);break}}if(u.historyRef){var y=!0,v=!1,g=void 0;try{for(var m,_=u.historyRef[Symbol.iterator]();!(y=(m=_.next()).done);y=!0){var S=m.value;s=S.isDeep?function(t){return t.typeEnum===C&&u.descendants.indexOf(t)>-1}:function(t){return t.parent===u},this._historyValue[S.id]=n.filter(s)}}catch(t){v=!0,g=t}finally{try{y||null==_.return||_.return()}finally{if(v)throw g}}}}return n}},{key:"_getStatesExited",value:function(t){for(var e=new this.opts.Set,n=new this.opts.Set,r=t.iter(),i=0,o=r.length;i<o;i++)for(var a=r[i].scope,s=a.descendants,u=this._configuration.iter(),c=0,l=u.length;c<l;c++){var f=u[c];if(s.indexOf(f)>-1){n.add(f),e.add(f);for(var p=m.getAncestors(f,a),h=0,d=p.length;h<d;h++)e.add(p[h])}}return[n,e.iter().sort(O)]}},{key:"_executeTransitions",value:function(t,e){var n=e.iter().sort(b);this._log("executing transitition actions");for(var r=0,i=n.length;r<i;r++){var o=n[r],a=o.targets&&o.targets.map(function(t){return t.id});if(this.emit("onTransition",o.source.id,a,o.source.transitions.indexOf(o)),void 0!==o.onTransition)for(var s=0,u=o.onTransition.length;s<u;s++){var c=o.onTransition[s];try{c.call(this._scriptingContext,t)}catch(t){this._handleError(t,c);break}}}}},{key:"_enterStates",value:function(t,e){var n=this;this._log("entering states");var r=new Set,i=new Set,o={};this._computeEntrySet(e,r,i,o),r=Array.from(r).sort(T),this._log("statesEntered ",r);for(var a=0,s=r.length;a<s;a++){if((k=r[a]).isAtomic&&this._configuration.add(k),this._log("entering",k.id),this.emit("onEntry",k.id),void 0!==k.onEntry)for(var u=0,c=k.onEntry.length;u<c;u++)for(var l=k.onEntry[u],f=0,p=l.length;f<p;f++){var h=l[f];try{h.call(this._scriptingContext,t)}catch(t){this._handleError(t,h);break}}if(i.has(k)){var d=!0,y=!1,v=void 0;try{for(var g,m=k.initialRef[Symbol.iterator]();!(d=(g=m.next()).done);d=!0){var _=g.value;if(this.emit("onDefaultEntry",_.id),_.typeEnum===z){var S=_.transitions[0];if(void 0!==S.onTransition){this._log("executing initial transition content for initial state of parent state",k.id);for(var b=0,E=S.onTransition.length;b<E;b++){var w=S.onTransition[b];try{w.call(this._scriptingContext,t)}catch(t){this._handleError(t,w);break}}}}}}catch(t){y=!0,v=t}finally{try{d||null==m.return||m.return()}finally{if(y)throw v}}}if(o[k.id]){var x=o[k.id];if(void 0!==x.onTransition){this._log("executing history transition content for history state of parent state",k.id);for(b=0,E=x.onTransition.length;b<E;b++){var O=x.onTransition[b];try{O.call(this._scriptingContext,t)}catch(t){this._handleError(t,O);break}}}}}for(a=0,s=r.length;a<s;a++){var k;if((k=r[a]).typeEnum===M){var A=k.parent,I=A.parent;this._internalEventQueue.push({name:"done.state."+A.id,data:k.donedata&&k.donedata.call(this._scriptingContext,t)}),I&&I.typeEnum===P&&I.states.every(function(t){return n.isInFinalState(t)})&&this._internalEventQueue.push({name:"done.state."+I.id})}}return r}},{key:"_getEffectiveTargetStates",value:function(t){var e=new Set,n=!0,r=!1,o=void 0;try{for(var a,s=t.targets[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;u.typeEnum===R?u.id in this._historyValue?this._historyValue[u.id].forEach(function(t){return e.add(t)}):i(this._getEffectiveTargetStates(u.transitions[0])).forEach(function(t){return e.add(t)}):e.add(u)}}catch(t){r=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(r)throw o}}return e}},{key:"_computeEntrySet",value:function(t,e,n,r){var i=!0,o=!1,a=void 0;try{for(var s,u=t.iter()[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value,l=!0,f=!1,p=void 0;try{for(var h,d=c.targets[Symbol.iterator]();!(l=(h=d.next()).done);l=!0){var y=h.value;this._addDescendantStatesToEnter(y,e,n,r)}}catch(t){f=!0,p=t}finally{try{l||null==d.return||d.return()}finally{if(f)throw p}}var v=c.scope,g=!0,m=!1,_=void 0;try{for(var S,b=this._getEffectiveTargetStates(c)[Symbol.iterator]();!(g=(S=b.next()).done);g=!0){var E=S.value;this._addAncestorStatesToEnter(E,v,e,n,r)}}catch(t){m=!0,_=t}finally{try{g||null==b.return||b.return()}finally{if(m)throw _}}}}catch(t){o=!0,a=t}finally{try{i||null==u.return||u.return()}finally{if(o)throw a}}}},{key:"_computeExitSet",value:function(t){var e=new Set,n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if(s.targets){var u=s.scope,c=!0,l=!1,f=void 0;try{for(var p,h=this._getFullConfiguration()[Symbol.iterator]();!(c=(p=h.next()).done);c=!0){var d=p.value;m.isDescendant(d,u)&&e.add(d)}}catch(t){l=!0,f=t}finally{try{c||null==h.return||h.return()}finally{if(l)throw f}}}}}catch(t){r=!0,i=t}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return e}},{key:"_addAncestorStatesToEnter",value:function(t,e,n,r,o){var a=this,s=function(t){if(t.typeEnum===P){var e=!0,s=!1,u=void 0;try{for(var c,l=function(){var t=c.value;t.typeEnum===R||i(n).some(function(e){return m.isDescendant(e,t)})||a._addDescendantStatesToEnter(t,n,r,o)},f=t.states[Symbol.iterator]();!(e=(c=f.next()).done);e=!0)l()}catch(t){s=!0,u=t}finally{try{e||null==f.return||f.return()}finally{if(s)throw u}}}},u=!0,c=!1,l=void 0;try{for(var f,p=m.getAncestors(t,e)[Symbol.iterator]();!(u=(f=p.next()).done);u=!0){var h=f.value;n.add(h),s(h)}}catch(t){c=!0,l=t}finally{try{u||null==p.return||p.return()}finally{if(c)throw l}}s(e)}},{key:"_addDescendantStatesToEnter",value:function(t,e,n,r){var o=this;if(t.typeEnum===R)if(this._historyValue[t.id]){var a=!0,s=!1,u=void 0;try{for(var c,l=this._historyValue[t.id][Symbol.iterator]();!(a=(c=l.next()).done);a=!0){var f=c.value;this._addDescendantStatesToEnter(f,e,n,r)}}catch(t){s=!0,u=t}finally{try{a||null==l.return||l.return()}finally{if(s)throw u}}var p=!0,h=!1,d=void 0;try{for(var y,v=this._historyValue[t.id][Symbol.iterator]();!(p=(y=v.next()).done);p=!0){var g=y.value;this._addAncestorStatesToEnter(g,t.parent,e,n,r)}}catch(t){h=!0,d=t}finally{try{p||null==v.return||v.return()}finally{if(h)throw d}}}else{r[t.parent.id]=t.transitions[0];var _=!0,S=!1,b=void 0;try{for(var E,w=t.transitions[0].targets[Symbol.iterator]();!(_=(E=w.next()).done);_=!0){var x=E.value;this._addDescendantStatesToEnter(x,e,n,r)}}catch(t){S=!0,b=t}finally{try{_||null==w.return||w.return()}finally{if(S)throw b}}var T=!0,O=!1,k=void 0;try{for(var A,I=t.transitions[0].targets[Symbol.iterator]();!(T=(A=I.next()).done);T=!0){var C=A.value;this._addAncestorStatesToEnter(C,t.parent,e,n,r)}}catch(t){O=!0,k=t}finally{try{T||null==I.return||I.return()}finally{if(O)throw k}}}else if(e.add(t),t.typeEnum===j){n.add(t);var M=!0,D=!1,L=void 0;try{for(var F,B=t.initialRef[Symbol.iterator]();!(M=(F=B.next()).done);M=!0){var $=F.value,N=$.typeEnum===z?$.transitions[0].targets:[$],U=!0,H=!1,Y=void 0;try{for(var Q,V=N[Symbol.iterator]();!(U=(Q=V.next()).done);U=!0){var G=Q.value;this._addDescendantStatesToEnter(G,e,n,r)}}catch(t){H=!0,Y=t}finally{try{U||null==V.return||V.return()}finally{if(H)throw Y}}}}catch(t){D=!0,L=t}finally{try{M||null==B.return||B.return()}finally{if(D)throw L}}var J=!0,W=!1,X=void 0;try{for(var q,Z=t.initialRef[Symbol.iterator]();!(J=(q=Z.next()).done);J=!0){var K=q.value,tt=K.typeEnum===z?K.transitions[0].targets:[K],et=!0,nt=!1,rt=void 0;try{for(var it,ot=tt[Symbol.iterator]();!(et=(it=ot.next()).done);et=!0){var at=it.value;this._addAncestorStatesToEnter(at,t,e,n,r)}}catch(t){nt=!0,rt=t}finally{try{et||null==ot.return||ot.return()}finally{if(nt)throw rt}}}}catch(t){W=!0,X=t}finally{try{J||null==Z.return||Z.return()}finally{if(W)throw X}}}else if(t.typeEnum===P){var st=!0,ut=!1,ct=void 0;try{for(var lt,ft=function(){var t=lt.value;t.typeEnum===R||i(e).some(function(e){return m.isDescendant(e,t)})||o._addDescendantStatesToEnter(t,e,n,r)},pt=t.states[Symbol.iterator]();!(st=(lt=pt.next()).done);st=!0)ft()}catch(t){ut=!0,ct=t}finally{try{st||null==pt.return||pt.return()}finally{if(ut)throw ct}}}}},{key:"isInFinalState",value:function(t){var e=this;return t.typeEnum===j?t.states.some(function(t){return t.typeEnum===M&&e._configuration.contains(t)}):t.typeEnum===P&&t.states.every(this.isInFinalState.bind(this))}},{key:"_evaluateAction",value:function(t,e){try{return e.call(this._scriptingContext,t)}catch(t){this._handleError(t,e)}}},{key:"_handleError",value:function(t,e){var n=t instanceof Error||"string"==typeof t.__proto__.name&&t.__proto__.name.match(/^.*Error$/)?{name:"error.execution",data:{tagname:e.tagname,line:e.line,column:e.column,reason:t.message},type:"platform"}:t.name?t:{name:"error.execution",data:t,type:"platform"};this._internalEventQueue.push(n),this.emit("onError",n)}},{key:"_log",value:function(){if(L){var t=Array.from(arguments);this.opts.console.log("".concat(t[0],": ").concat(t.slice(1).map(function(t){return null===t?"null":void 0===t?"undefined":"string"==typeof t?t:"[object Object]"===t.toString()?d.inspect(t):t.toString()}).join(", "),"\n"))}}},{key:"registerListener",value:function(t){n.EVENTS.forEach(function(e){t[e]&&this.on(e,t[e])},this)}},{key:"unregisterListener",value:function(t){n.EVENTS.forEach(function(e){t[e]&&this.off(e,t[e])},this)}},{key:"getAllTransitionEvents",value:function(){var t={};return function e(n){if(n.transitions)for(var r=0,i=n.transitions.length;r<i;r++)t[n.transitions[r].event]=!0;if(n.states)for(var o=0,a=n.states.length;o<a;o++)e(n.states[o])}(this._model),Object.keys(t)}},{key:"getSnapshot",value:function(){return[this.getConfiguration(),this._serializeHistory(),this._isInFinalState,this._model.$serializeDatamodel(),this._internalEventQueue.slice()]}},{key:"_serializeHistory",value:function(){var t={};return Object.keys(this._historyValue).forEach(function(e){t[e]=this._historyValue[e].map(function(t){return t.id})},this),t}},{key:"gen",value:function(t,e){var n;switch(a(t)){case"string":n={name:t,data:e};break;case"object":if("string"!=typeof t.name)throw new Error('Event object must have "name" property of type string.');n=t;break;default:throw new Error("First argument to gen must be a string or object.")}if(this._isStepping)throw new Error("Cannot call gen during a big-step");return this._isStepping=!0,this._performBigStep(n),this._isStepping=!1,this.getConfiguration()}},{key:"genAsync",value:function(t,e){if(null!==t&&("object"!==a(t)||!t||"string"!=typeof t.name))throw new Error("Expected currentEvent to be null or an Object with a name");"function"!=typeof e&&(e=B),this._externalEventQueue.push([t,e]),this._isStepping||(this._isStepping=!0,function t(e,n){this._performBigStepAsync(e,function(e,r){n(e,r),this._externalEventQueue.length?t.apply(this,this._externalEventQueue.shift()):this._isStepping=!1}.bind(this))}.apply(this,this._externalEventQueue.shift()))}}]),n}();function B(){}F.EVENTS=["onEntry","onExit","onTransition","onDefaultEntry","onError","onBigStepBegin","onBigStepSuspend","onBigStepResume","onSmallStepBegin","onSmallStepEnd","onBigStepEnd","onExitInterpreter"],F.sessionIdCounter=1,F.generateSessionid=function(){return F.sessionIdCounter++},F.sessionRegistry=new Map;var $=function(){function t(e){s(this,t),this._interpreter=e,this._timeoutMap={},this._invokeMap={},this._timeouts=new Set,this.validateUriRegex=/(#_.*)|\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/i,this.invokeSendTargetRegex=/^#_(.*)$/,this.scxmlSendTargetRegex=/^#_scxml_(.*)$/}return c(t,[{key:"raise",value:function(t){this._installDefaultPropsOnEvent(t,!0),this._interpreter._internalEventQueue.push(t)}},{key:"parseXmlStringAsDOM",value:function(e){return(this._interpreter.opts.xmlParser||t.xmlParser).parse(e)}},{key:"invoke",value:function(e){var n=this;this._invokeMap[e.id]=new Promise(function(r,i){(n._interpreter.opts.invokers||t.invokers)[e.type](n._interpreter,e,n._interpreter.opts.invokerExecutionContext,function(t,e){if(t)return i(t);n._interpreter.emit("onInvokedSessionInitialized",e),r(e)})})}},{key:"cancelInvoke",value:function(t){var e=this,n=this._invokeMap[t];this._interpreter._log("cancelling session with invokeid ".concat(t)),n&&(this._interpreter._log("sessionPromise found"),n.then(function(n){e._interpreter._log("resolved session ".concat(t,". cancelling... ")),n.cancel(),delete e._invokeMap[t]},function(t){}))}},{key:"_installDefaultPropsOnEvent",value:function(t,e){e||(t.origin=this._interpreter.opts._x._ioprocessors.scxml.location,t.origintype=t.type||D),void 0===t.type&&(t.type=e?"internal":"external"),["name","sendid","invokeid","data","origin","origintype"].forEach(function(e){void 0===t[e]&&(t[e]=void 0)})}},{key:"send",value:function(t,e){this._interpreter._log("send event",t,e);var n,r=(e=e||{}).type||D;n="https://github.com/jbeard4/SCION#publish"===t.type?function(){this._interpreter.emit(t.name,t.data)}:this._interpreter.opts.customSend?this._interpreter.opts.customSend:function(t,e){var n,r=this;if("undefined"==typeof setTimeout)throw new Error("Default implementation of BaseInterpreter.prototype.send will not work unless setTimeout is defined globally.");if("#_internal"===t.target)this.raise(t);else if(this._installDefaultPropsOnEvent(t,!1),t.origintype=D,t.target)if("#_parent"===t.target){if(!this._interpreter.opts.parentSession)throw{name:"error.communication",data:"Parent session not specified",sendid:t.sendid,type:"platform"};t.invokeid=this._interpreter.opts.invokeid,s.call(this,this._interpreter.opts.parentSession)}else if(n=t.target.match(this.scxmlSendTargetRegex)){var i=n[1],o=this._interpreter.opts.sessionRegistry.get(i);if(!o)throw{name:"error.communication",sendid:t.sendid,type:"platform"};s.call(this,o)}else{if(!(n=t.target.match(this.invokeSendTargetRegex)))throw new Error("Unrecognized send target.");var a=n[1];this._invokeMap[a].then(function(t){s.call(r,t)})}else s.call(this,this._interpreter);function s(n){var r=setTimeout(function(){t.sendid&&delete this._timeoutMap[t.sendid],this._timeouts.delete(i),this._interpreter.opts.doSend?this._interpreter.opts.doSend(n,t):n[this._interpreter.opts.sendAsync?"genAsync":"gen"](t)}.bind(this),e.delay||0),i={sendOptions:e,timeoutHandle:r};t.sendid&&(this._timeoutMap[t.sendid]=r),this._timeouts.add(i)}},e=e||{},this._interpreter._log("sending event",t.name,"with content",t.data,"after delay",e.delay),function(t,e,n){if(t.target&&!this.validateUriRegex.test(t.target))throw{name:"error.execution",data:"Target is not valid URI",sendid:t.sendid,type:"platform"};if(r!==D)throw{name:"error.execution",data:"Unsupported event processor type",sendid:t.sendid,type:"platform"};n.call(this,t,e)}.call(this,t,e,n)}},{key:"cancel",value:function(t){if(this._interpreter.opts.customCancel)return this._interpreter.opts.customCancel.apply(this,[t]);if("undefined"==typeof clearTimeout)throw new Error("Default implementation of BaseInterpreter.prototype.cancel will not work unless setTimeout is defined globally.");t in this._timeoutMap&&(this._interpreter._log("cancelling ",t," with timeout id ",this._timeoutMap[t]),clearTimeout(this._timeoutMap[t]))}}]),t}();t.exports=_(new h,{BaseInterpreter:F,ArraySet:y,STATE_TYPES:v.STATE_TYPES,initializeModel:E,InterpreterScriptingContext:$,helpers:g,query:m})}).call(this,n(0),n(2).setImmediate)},function(t,e){function n(){this._listeners={}}n.prototype.on=function(t,e){return Array.isArray(this._listeners[t])||(this._listeners[t]=[]),-1===this._listeners[t].indexOf(e)&&this._listeners[t].push(e),this},n.prototype.once=function(t,e){var n=this;function r(){for(var i=[],o=0;o<arguments.length;o+=1)i[o]=arguments[o];n.off(t,r),e.apply(n,i)}return r.listener=e,this.on(t,r)},n.prototype.off=function(t,e){if(!Array.isArray(this._listeners[t]))return this;if(void 0===e)return this._listeners[t]=[],this;var n=this._listeners[t].indexOf(e);if(-1===n)for(var r=0;r<this._listeners[t].length;r+=1)if(this._listeners[t][r].listener===e){n=r;break}return this._listeners[t].splice(n,1),this},n.prototype.emit=function(t){if(!Array.isArray(this._listeners[t]))return this;for(var e=[],n=1;n<arguments.length;n+=1)e[n-1]=arguments[n];return this._listeners[t].forEach(function(t){t.apply(this,e)},this),this},t.exports.EventEmitter=n},function(t,e,n){(function(t){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var i=Object.getOwnPropertyDescriptors||function(t){for(var e=Object.keys(t),n={},r=0;r<e.length;r++)n[e[r]]=Object.getOwnPropertyDescriptor(t,e[r]);return n},o=/%[sdj%]/g;e.format=function(t){if(!m(t)){for(var e=[],n=0;n<arguments.length;n++)e.push(u(arguments[n]));return e.join(" ")}n=1;for(var r=arguments,i=r.length,a=String(t).replace(o,function(t){if("%%"===t)return"%";if(n>=i)return t;switch(t){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(t){return"[Circular]"}default:return t}}),s=r[n];n<i;s=r[++n])v(s)||!b(s)?a+=" "+s:a+=" "+u(s);return a},e.deprecate=function(n,r){if(void 0!==t&&!0===t.noDeprecation)return n;if(void 0===t)return function(){return e.deprecate(n,r).apply(this,arguments)};var i=!1;return function(){if(!i){if(t.throwDeprecation)throw new Error(r);t.traceDeprecation?console.trace(r):console.error(r),i=!0}return n.apply(this,arguments)}};var a,s={};function u(t,n){var r={seen:[],stylize:l};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),y(n)?r.showHidden=n:n&&e._extend(r,n),_(r.showHidden)&&(r.showHidden=!1),_(r.depth)&&(r.depth=2),_(r.colors)&&(r.colors=!1),_(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=c),f(r,t,r.depth)}function c(t,e){var n=u.styles[e];return n?"["+u.colors[n][0]+"m"+t+"["+u.colors[n][1]+"m":t}function l(t,e){return t}function f(t,n,r){if(t.customInspect&&n&&x(n.inspect)&&n.inspect!==e.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,t);return m(i)||(i=f(t,i,r)),i}var o=function(t,e){if(_(e))return t.stylize("undefined","undefined");if(m(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}if(g(e))return t.stylize(""+e,"number");if(y(e))return t.stylize(""+e,"boolean");if(v(e))return t.stylize("null","null")}(t,n);if(o)return o;var a=Object.keys(n),s=function(t){var e={};return t.forEach(function(t,n){e[t]=!0}),e}(a);if(t.showHidden&&(a=Object.getOwnPropertyNames(n)),w(n)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return p(n);if(0===a.length){if(x(n)){var u=n.name?": "+n.name:"";return t.stylize("[Function"+u+"]","special")}if(S(n))return t.stylize(RegExp.prototype.toString.call(n),"regexp");if(E(n))return t.stylize(Date.prototype.toString.call(n),"date");if(w(n))return p(n)}var c,l="",b=!1,T=["{","}"];(d(n)&&(b=!0,T=["[","]"]),x(n))&&(l=" [Function"+(n.name?": "+n.name:"")+"]");return S(n)&&(l=" "+RegExp.prototype.toString.call(n)),E(n)&&(l=" "+Date.prototype.toUTCString.call(n)),w(n)&&(l=" "+p(n)),0!==a.length||b&&0!=n.length?r<0?S(n)?t.stylize(RegExp.prototype.toString.call(n),"regexp"):t.stylize("[Object]","special"):(t.seen.push(n),c=b?function(t,e,n,r,i){for(var o=[],a=0,s=e.length;a<s;++a)A(e,String(a))?o.push(h(t,e,n,r,String(a),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(h(t,e,n,r,i,!0))}),o}(t,n,r,s,a):a.map(function(e){return h(t,n,r,s,e,b)}),t.seen.pop(),function(t,e,n){if(t.reduce(function(t,e){return 0,e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1];return n[0]+e+" "+t.join(", ")+" "+n[1]}(c,l,T)):T[0]+l+T[1]}function p(t){return"["+Error.prototype.toString.call(t)+"]"}function h(t,e,n,r,i,o){var a,s,u;if((u=Object.getOwnPropertyDescriptor(e,i)||{value:e[i]}).get?s=u.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):u.set&&(s=t.stylize("[Setter]","special")),A(r,i)||(a="["+i+"]"),s||(t.seen.indexOf(u.value)<0?(s=v(n)?f(t,u.value,null):f(t,u.value,n-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+s.split("\n").map(function(t){return"   "+t}).join("\n")):s=t.stylize("[Circular]","special")),_(a)){if(o&&i.match(/^\d+$/))return s;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=t.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=t.stylize(a,"string"))}return a+": "+s}function d(t){return Array.isArray(t)}function y(t){return"boolean"==typeof t}function v(t){return null===t}function g(t){return"number"==typeof t}function m(t){return"string"==typeof t}function _(t){return void 0===t}function S(t){return b(t)&&"[object RegExp]"===T(t)}function b(t){return"object"===r(t)&&null!==t}function E(t){return b(t)&&"[object Date]"===T(t)}function w(t){return b(t)&&("[object Error]"===T(t)||t instanceof Error)}function x(t){return"function"==typeof t}function T(t){return Object.prototype.toString.call(t)}function O(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(n){if(_(a)&&(a=t.env.NODE_DEBUG||""),n=n.toUpperCase(),!s[n])if(new RegExp("\\b"+n+"\\b","i").test(a)){var r=t.pid;s[n]=function(){var t=e.format.apply(e,arguments);console.error("%s %d: %s",n,r,t)}}else s[n]=function(){};return s[n]},e.inspect=u,u.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},u.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=d,e.isBoolean=y,e.isNull=v,e.isNullOrUndefined=function(t){return null==t},e.isNumber=g,e.isString=m,e.isSymbol=function(t){return"symbol"===r(t)},e.isUndefined=_,e.isRegExp=S,e.isObject=b,e.isDate=E,e.isError=w,e.isFunction=x,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"===r(t)||void 0===t},e.isBuffer=n(10);var k=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function A(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){var t,n;console.log("%s - %s",(t=new Date,n=[O(t.getHours()),O(t.getMinutes()),O(t.getSeconds())].join(":"),[t.getDate(),k[t.getMonth()],n].join(" ")),e.format.apply(e,arguments))},e.inherits=n(11),e._extend=function(t,e){if(!e||!b(e))return t;for(var n=Object.keys(e),r=n.length;r--;)t[n[r]]=e[n[r]];return t};var I="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function C(t,e){if(!t){var n=new Error("Promise was rejected with a falsy value");n.reason=t,t=n}return e(t)}e.promisify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');if(I&&t[I]){var e;if("function"!=typeof(e=t[I]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(e,I,{value:e,enumerable:!1,writable:!1,configurable:!0}),e}function e(){for(var e,n,r=new Promise(function(t,r){e=t,n=r}),i=[],o=0;o<arguments.length;o++)i.push(arguments[o]);i.push(function(t,r){t?n(t):e(r)});try{t.apply(this,i)}catch(t){n(t)}return r}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),I&&Object.defineProperty(e,I,{value:e,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(e,i(t))},e.promisify.custom=I,e.callbackify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function n(){for(var n=[],r=0;r<arguments.length;r++)n.push(arguments[r]);var i=n.pop();if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");var o=this,a=function(){return i.apply(o,arguments)};e.apply(this,n).then(function(e){t.nextTick(a,null,e)},function(e){t.nextTick(C,e,a)})}return Object.setPrototypeOf(n,Object.getPrototypeOf(e)),Object.defineProperties(n,i(e)),n}}).call(this,n(0))},function(t,e){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}t.exports=function(t){return t&&"object"===n(t)&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},function(t,e){function n(t){t=t||[],this.o=new Set(t)}n.prototype={add:function(t){this.o.add(t)},remove:function(t){return this.o.delete(t)},union:function(t){var e=!0,n=!1,r=void 0;try{for(var i,o=t.o[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;this.o.add(a)}}catch(t){n=!0,r=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw r}}return this},difference:function(t){var e=!0,n=!1,r=void 0;try{for(var i,o=t.o[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;this.o.delete(a)}}catch(t){n=!0,r=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw r}}return this},contains:function(t){return this.o.has(t)},iter:function(){return Array.from(this.o)},isEmpty:function(){return!this.o.size},size:function(){return this.o.size},equals:function(t){if(this.o.size!==t.size())return!1;var e=!0,n=!1,r=void 0;try{for(var i,o=this.o[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;if(!t.contains(a))return!1}}catch(t){n=!0,r=t}finally{try{e||null==o.return||o.return()}finally{if(n)throw r}}return!0},toString:function(){return 0===this.o.size?"<empty>":Array.from(this.o).join(",\n")}},t.exports=n},function(t,e,n){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var i=n(1),o=i.STATE_TYPES,a=i.RX_TRAILING_WILDCARD,s=!1;function u(t,e){return(t=t.replace(a,""))===e||!(t.length>e.length)&&("."===e.charAt(t.length)&&0===e.indexOf(t))}function c(t,e){return t.events.some(function(t){return"*"===t||u(t,e)})}function l(t,e){return t.depth>e.depth?-1:t.depth<e.depth?1:t.documentOrder<e.documentOrder?1:t.documentOrder>e.documentOrder?-1:0}t.exports={extend:function(t,e){return Object.keys(e).forEach(function(n){t[n]=e[n]}),t},transitionWithTargets:function(t){return t.targets},transitionComparator:function(t,e){return t.documentOrder-e.documentOrder},initializeModel:function(t,e){var n=[],i=new Map,a=0,u={};var c=[];function l(t){return"".concat(t," -- ").concat(this.events?"("+this.events.join(",")+")":null).concat(this.cond?"["+this.cond.name+"]":""," --\x3e ").concat(this.targets?this.targets.join(","):null)}function f(){return this.id}function p(t){if(!t.initialRef)throw new Error("Unable to locate initial state for composite state: "+t.id)}var h=/\s+/;function d(t){var e="internal"===t.type&&t.source.typeEnum===o.COMPOSITE&&t.source.parent&&t.targets&&t.targets.every(function(e){return t.source.descendants.indexOf(e)>-1});return t.targets?e?t.source:t.lcca:null}function y(t,n){for(var r=[],i=0,a=t.ancestors.length;i<a;i++){var s=t.ancestors[i];(e&&e.legacySemantics?s.typeEnum===o.COMPOSITE:s.typeEnum===o.COMPOSITE||s.typeEnum===o.PARALLEL)&&s.descendants.indexOf(n)>-1&&r.push(s)}if(!r.length)throw new Error("Could not find LCA for states.");return r[0]}!function t(e){e.id&&i.set(e.id,e);if(e.states)for(var n=0,r=e.states.length;n<r;n++)t(e.states[n])}(t);var v=(g=t,{$deserializeDatamodel:g.$deserializeDatamodel||function(){},$serializeDatamodel:g.$serializeDatamodel||function(){return null},$idToStateMap:i,docUrl:g.docUrl,name:g.name,states:[{$type:"initial",transitions:[{target:g}]},g]});var g;return function t(e,r){s&&(r.toString=f),r.transitions&&n.push.apply(n,r.transitions),r.$type=r.$type||"state",r.ancestors=e,r.depth=e.length,r.parent=e[0],r.documentOrder=a++,r.transitions=r.transitions||[];for(var h=0,d=r.transitions.length;h<d;h++){var y=r.transitions[h];y.documentOrder=a++,y.source=r,s&&(y.toString=l.bind(y,r))}if(r.states)for(var v=[r].concat(e),h=0,d=r.states.length;h<d;h++)t(v,r.states[h]);switch(r.$type){case"parallel":r.typeEnum=o.PARALLEL,r.isAtomic=!1;break;case"initial":r.typeEnum=o.INITIAL,r.isAtomic=!0;break;case"history":r.typeEnum=o.HISTORY,r.isAtomic=!0;break;case"final":r.typeEnum=o.FINAL,r.isAtomic=!0;break;case"state":case"scxml":r.states&&r.states.length?(r.typeEnum=o.COMPOSITE,r.isAtomic=!1):(r.typeEnum=o.BASIC,r.isAtomic=!0);break;default:throw new Error("Unknown state type: "+r.$type)}var g;if(r.states?r.descendants=r.states.concat(r.states.map(function(t){return t.descendants}).reduce(function(t,e){return t.concat(e)},[])):r.descendants=[],r.typeEnum===o.COMPOSITE&&(Array.isArray(r.initial)||"string"==typeof r.initial?c.push(r):(g=r.states.filter(function(t){return"initial"===t.$type}),r.initialRef=[g.length?g[0]:r.states[0]],p(r))),r.typeEnum===o.COMPOSITE||r.typeEnum===o.PARALLEL){var m=r.states.filter(function(t){return"history"===t.$type});r.historyRef=m}r.id||(r.id=function(t){void 0===u[t]&&(u[t]=0);do{var e=u[t]++,n="$generated-"+t+"-"+e}while(i.has(n));return n}(r.$type),i.set(r.id,r)),["onEntry","onExit"].forEach(function(t){r[t]&&(Array.isArray(r[t])||(r[t]=[r[t]]),r[t].every(function(t){return Array.isArray(t)})||(r[t]=[r[t]]))}),r.invokes&&!Array.isArray(r.invokes)&&(r.invokes=[r.invokes],r.invokes.forEach(function(t){t.finalize&&!Array.isArray(t.finalize)&&(t.finalize=[t.finalize])}))}([],v),function(){for(var t=0,e=n.length;t<e;t++){var o=n[t];if(o.onTransition&&!Array.isArray(o.onTransition)&&(o.onTransition=[o.onTransition]),"string"==typeof o.event&&(o.events=o.event.trim().split(h)),delete o.event,!o.targets&&void 0!==o.target)if("string"==typeof o.target){var a=i.get(o.target);if(!a)throw new Error("Unable to find target state with id "+o.target);o.target=a,o.targets=[o.target]}else if(Array.isArray(o.target))o.targets=o.target.map(function(t){if("string"==typeof t){if(!(t=i.get(t)))throw new Error("Unable to find target state with id "+o.target);return t}return t});else{if("object"!==r(o.target))throw new Error("Transition target has unknown type: "+o.target);o.targets=[o.target]}}for(var t=0,e=n.length;t<e;t++){var o=n[t];o.targets&&(o.lcca=y(o.source,o.targets[0])),o.scope=d(o)}}(),function(){for(var t=0,e=c.length;t<e;t++){var n=c[t],r=Array.isArray(n.initial)?n.initial:[n.initial];n.initialRef=r.map(function(t){return i.get(t)}),p(n)}}(),v},isEventPrefixMatch:u,isTransitionMatch:c,scxmlPrefixTransitionSelector:function(t,e,n,r){return(r?!t.events:t.events&&e&&e.name&&c(t,e.name))&&(!t.cond||n(t.cond))},eventlessTransitionSelector:function(t){return t.transitions.filter(function(t){return!t.events||t.events&&0===t.events.length})},getTransitionWithHigherSourceChildPriority:function(t){var e=t[0],n=t[1];l(e.source,n.source);return e.source.depth<n.source.depth?n:n.source.depth<e.source.depth?e:e.documentOrder<n.documentOrder?e:n},sortInEntryOrder:function(t,e){return-1*l(t,e)},getStateWithHigherSourceChildPriority:l,initializeModelGeneratorFn:function(t,e,n){return t.call(n,e._x,e._x._sessionid,e._x._ioprocessors,n.isIn.bind(n))},deserializeSerializedConfiguration:function(t,e){return t.map(function(t){var n=e.get(t);if(!n)throw new Error("Error loading serialized configuration. Unable to locate state with id "+t);return n})},deserializeHistory:function(t,e){var n={};return Object.keys(t).forEach(function(r){n[r]=t[r].map(function(t){var n=e.get(t);if(!n)throw new Error("Error loading serialized history. Unable to locate state with id "+t);return n})}),n}}},function(t,e,n){var r=n(1),i={isDescendant:function(t,e){return e.descendants.indexOf(t)>-1},getAncestors:function(t,e){var n;return(n=t.ancestors.indexOf(e))>-1?t.ancestors.slice(0,n):t.ancestors},isOrthogonalTo:function(t,e){return!this.isAncestrallyRelatedTo(t,e)&&this.getLCA(t,e).typeEnum===r.STATE_TYPES.PARALLEL},isAncestrallyRelatedTo:function(t,e){return this.getAncestorsOrSelf(e).indexOf(t)>-1||this.getAncestorsOrSelf(t).indexOf(e)>-1},getAncestorsOrSelf:function(t,e){return[t].concat(i.getAncestors(t,e))},getDescendantsOrSelf:function(t){return[t].concat(t.descendants)},getLCA:function(t,e){return this.getAncestors(t).filter(function(t){return t.descendants.indexOf(e)>-1},this)[0]}};t.exports=i}])});
//# sourceMappingURL=scion-core-lib.min.js.map